/**
 * Client: TERMINALFOUR
 * Project: Sample Data Wireframes
 * Version: 0.1.0
 * Description: Wireframing project for the new sample data
 * Copyright 2014
 * Created by Hugh Law
 * on behalf of TERMINALFOUR
 * www.terminalfour.com
 */
function parallaxSmall(){var a=$(window).scrollTop(),b=$(window).height(),c=$(".parallax-small").offset().top;a+b>=c&&$(".parallax-small img").css("top",-(a/6)+"px")}function parallaxLarge(){var a=$(window).scrollTop(),b=$(window).height(),c=$(".parallax-large").offset().top;a+b>=c&&$(".parallax-large img").css("top",-(a/6)+"px")}!function(a){"use strict";var b=function(){var a=document.createElement("div");return a.style.cssText="font-size: 1rem;",/rem/.test(a.style.fontSize)},c=function(){for(var a=document.getElementsByTagName("link"),b=[],c=0;c<a.length;c++)"stylesheet"===a[c].rel.toLowerCase()&&null===a[c].getAttribute("data-norem")&&b.push(a[c].href);return b},d=function(){for(var a=0;a<m.length;a++)j(m[a],e)},e=function(a,b){if(q.push(a.responseText),r.push(b),r.length===m.length){for(var c=0;c<r.length;c++)f(q[c],r[c]);(m=n.slice(0)).length>0?(r=[],q=[],n=[],d()):g()}},f=function(a,b){for(var c,d=k(a).replace(/\/\*[\s\S]*?\*\//g,""),e=/[\w\d\s\-\/\\\[\]:,.'"*()<>+~%#^$_=|@]+\{[\w\d\s\-\/\\%#:!;,.'"*()]+\d*\.?\d+rem[\w\d\s\-\/\\%#:!;,.'"*()]*\}/g,f=d.match(e),g=/\d*\.?\d+rem/g,h=d.match(g),i=/(.*\/)/,j=i.exec(b)[0],l=/@import (?:url\()?['"]?([^'\)"]*)['"]?\)?[^;]*/gm;null!==(c=l.exec(a));)n.push(j+c[1]);null!==f&&0!==f.length&&(o=o.concat(f),p=p.concat(h))},g=function(){for(var a=/[\w\d\s\-\/\\%#:,.'"*()]+\d*\.?\d+rem[\w\d\s\-\/\\%#:!,.'"*()]*[;}]/g,b=0;b<o.length;b++){l+=o[b].substr(0,o[b].indexOf("{")+1);for(var c=o[b].match(a),d=0;d<c.length;d++)l+=c[d],d===c.length-1&&"}"!==l[l.length-1]&&(l+="\n}")}h()},h=function(){for(var a=0;a<p.length;a++)s[a]=Math.round(parseFloat(p[a].substr(0,p[a].length-3)*t))+"px";i()},i=function(){for(var a=0;a<s.length;a++)s[a]&&(l=l.replace(p[a],s[a]));var b=document.createElement("style");b.setAttribute("type","text/css"),b.id="remReplace",document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet?b.styleSheet.cssText=l:b.appendChild(document.createTextNode(l))},j=function(b,c){try{var d=a.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP")||new ActiveXObject("Msxml2.XMLHTTP"):new XMLHttpRequest;d.open("GET",b,!0),d.onreadystatechange=function(){4===d.readyState&&c(d,b)},d.send(null)}catch(e){if(a.XDomainRequest){var f=new XDomainRequest;f.open("get",b),f.onload=function(){c(f,b)},f.onerror=function(){return!1},f.send()}}},k=function(b){return a.matchMedia||a.msMatchMedia||(b=b.replace(/@media[\s\S]*?\}\s*\}/g,"")),b};if(!b()){var l="",m=c(),n=[],o=[],p=[],q=[],r=[],s=[],t="";t=function(){var a,b=document,c=b.documentElement,d=b.body||b.createElement("body"),e=!b.body,f=b.createElement("div"),g=d.style.fontSize;return e&&c.appendChild(d),f.style.cssText="width:1em; position:absolute; visibility:hidden; padding: 0;",d.style.fontSize="1em",d.appendChild(f),a=f.offsetWidth,e?c.removeChild(d):(d.removeChild(f),d.style.fontSize=g),a}(),d()}}(window),$(".parallax-small").length&&$(window).scroll(function(){parallaxSmall()}),$(".parallax-large").length&&$(window).scroll(function(){parallaxLarge()});

/* to put range slider value into form submit */
    $('#captcha-form').submit(function() { 
      
        var payrange = $('#pay-range-slider').val();
        $('#t4_admissions_query_el_WillingToPay').val(payrange);
     
    });  
/* ./to put range slider value into form submit */


/* Cookie */

    /* cookie functions */
          function setCookie(cname, cvalue, exdays) {
              var d = new Date();
              d.setTime(d.getTime() + (exdays*24*60*60*1000));
              var expires = "expires="+d.toUTCString();
              document.cookie = cname + "=" + cvalue + "; " + expires + ";" + "path=/";
          }

          function getCookie(cname) {
                var name = cname + "=";
                var ca = document.cookie.split(';');
                for(var i=0; i<ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0)==' ') c = c.substring(1);
                    if (c.indexOf(name) != -1) return c.substring(name.length, c.length);
                }
                return "";
            }

          function checkCookie(cookieName) {
              var level = getCookie(cookieName);
              if (level == "") {
                   $('#QL-Default').removeClass('is-hidden');
              } 
              else if(level === "Undergraduate"){
                    $('#QL-Undergraduate').removeClass('is-hidden');
              }
              else if(level === "Postgraduate"){
                    $('#QL-Postgraduate').removeClass('is-hidden');
              }
              else {
                  $('#QL-Default').removeClass('is-hidden');
              }
          }


		function sliderCookie(cookieName){

            var studyLevel = getCookie(cookieName);

            $('.slick-slider div').each(function(){
                if (studyLevel !== "") {
                    var $this = $(this);
                    if($(this).hasClass(studyLevel)){
                        $this.parent().prepend($this);
                    }
                }
            });
        }

        sliderCookie("courseType"); //run the slider changes for course type cookie




     /* ./cookie functions */

$('.home-course-search').submit(function() { 
          setCookie('courseType',"",7);
          var searchParameter = $('.home-course-search input[name="courseType"]:checked').val();
          setCookie('courseType',searchParameter,7);
      });  

 $('.sidebar-course-search').submit(function() { 
          setCookie('courseType',"",7);
          var searchParameter = $('.sidebar-course-search #course-level :selected').text();
          setCookie('courseType',searchParameter,7);
      });  


$(document).ready(function() {

var col_group = $(".blog-page .main-content > .columns");
if ( $('.blog-page').length && $('#comments').length <= 0 ){ 
   
  setTimeout(function (){
    equalHeight(col_group);
  }, 500); // how long do you want the delay to be? 

} else {
  resizeSidebar(col_group);
}



  setTimeout(function (){

        if( $('.main_content_course_compare').length){


              $('.main_content_course_compare .collapse-all').hide();
              $('.main_content_course_compare .expand-all').on('click', function() {
                $('.main_content_course_compare .accordion-navigation').addClass('active');
                $('.main_content_course_compare .accordion-navigation>div').addClass('active');
                $('.main_content_course_compare .button.excol').toggle();
                
                return false;
              });

              $('.main_content_course_compare .collapse-all').on('click', function() {
                $('.main_content_course_compare .accordion-navigation').removeClass('active');
                $('.main_content_course_compare .accordion-navigation>div').removeClass('active');
                $('.main_content_course_compare .button.excol').toggle();
                
                return false;
              });


        } //end if .main_content_course_compare exists




  }, 500); // how long do you want the delay to be? 




    if ( $('.quicklinks').length ){ 
        checkCookie("courseType");
    }; //end check for existence

    //navigation addition of active class
  $('.top-bar-section ul li span').parent().addClass('active');
  $('.top-bar-section ul li span a').unwrap();

}); //end doc ready

if ( $('.cc-compare-table').length ){ 
  $('.cc-compare-table tr ').each(function(index) {
    $(this).find('.cc-data:even').addClass('even-one');
  });
}; //end check for existence



if ( $('.course-info').length ){ 
  $('.collapse-all').hide();
  $('.expand-all').on('click', function() {
    $('.accordion>dd').addClass('active');
    $('.accordion>dd>div').addClass('active');
    $('.button.excol').toggle();
    return false;
  });

  $('.collapse-all').on('click', function() {
    $('.accordion>dd').removeClass('active');
    $('.accordion>dd>div').removeClass('active');
    $('.button.excol').toggle();
    return false;
  });
}; //end check for existence


// Fix styling on news listing
if ($('.prev-next').length) {
  $('.prev-next a:contains("Next news story")').addClass('right'); 
}

if ($('.sitemap').length) {
  // Start the sitemap open or closed
  var startOpen = true;
  
  // Set the Fontawesome icons you want to use here
  var bullet = "fa";
  var plus = "fa fa-plus-circle";
  var minus = "fa fa-minus-circle";

  $(document).ready(function () {
    // Add an open class to ul elements
    if (startOpen) {
      $(".sitemap ul li ul").addClass("open");
    }
  
    // Add in the new bullet points
    $(".sitemap ul li").prepend("<i class=\"" + bullet + "\"></i>");

    // Add in the plus icons on li elements that contain a ul
    $('.sitemap li').each(function(){   
      var parent = $(this).parent().parent();
      if(parent.is("li")){
        var startingIcon = (startOpen) ? minus : plus;
        parent.addClass("parent-item");
        parent.children("i").remove(".fa");
        parent.prepend("<i class=\"" + startingIcon + "\"></i>");
      }
    });

    // Toggle UL on click of the plus/minus icon and swap them
    $(document).on('click','.parent-item i', function() {
      var className = $(this).attr("class");
      $(this).parent().children("ul").slideToggle("fast");
      
      if (className == plus) {
        $(this).parent().prepend("<i class=\"" + minus + "\"></i>");
      }
      else {
        $(this).parent().prepend("<i class=\"" + plus + "\"></i>"); 
      }
      
      $(this).remove(".fa");
      return false;
    });

    // Ignore clicks on bullet points not containing a child ul
    $('.sitemap li:not(".parent-item") i').click(function(){
      return false;
    });
  }); //end doc ready
}

$(document).foundation({
  accordion: {
    multi_expand: true,
    toggleable: true
  }, 
  slider: {
    on_change: function() {}
  },
  abide : {}
});



$(function () {
  if ( $.isFunction($.fn.fdatepicker) ) {
    $('#start').fdatepicker({closeButton: true});
    $('#end').fdatepicker({closeButton: true});
    $('#ad1').fdatepicker({closeButton: true});
    $('#ad2').fdatepicker({closeButton: true});
    $('#ad3').fdatepicker({closeButton: true});
  }
});
      
function equalHeight(group) {
  var tallest = 0;
  group.each(function() {
    var thisHeight = $(this).height();
    if(thisHeight > tallest) {
      tallest = thisHeight;
    }
  });
  group.height(tallest);
}

function resizeDivsAfterComment() {
  var divsToResize = $(".blog-page .main-content > .columns");
  divsToResize.height('auto');
  equalHeight(divsToResize);
}
      
/* Blog Tags */
function loadBlogTags(queryString) {
  var output= "";
  $.getJSON('/life-at-t4u/blog/tagged-content/data.json', function(data) {
    if (queryString["search"] != null) {
      var myExp  = queryString["search"]; 
      $.each(data, function(key, val) {
        if ((val.tags.search(myExp) != -1)) {
          output += '<article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting" class="listing cf"><div class="article-content-wrapper large-12 medium-12 small-12"><div class="article-info large-3 medium-3 small-12"><ul><li> <time itemprop="dateCreated" datetime="' + val.date_time + '">'+val.post_time + '</time></li><li><span class="user hidden-phone" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">' + val.Author +'</span></span></li></ul></div>';
          output += '<div class="article-heading flex-box cf large-9 medium-9 small-12"><h2><a href="'+ val.link +'" itemprop="headline">' + val.title + '</a></h2><div class="left"><span class="comments-count smaller"><a href="" title="Read More"></a></span></div><p itemprop="description" class="intro">'+val.abstract+'</p>';
          output += '<a href="'+ val.link +'" class="read-more blue-grad button" title="Read more">Read More...</a></div></div></article>';
        }
      }); //get JSON
    } else {
      output="<p>There are no articles matching provided keyword.</p>";
    }    
    $('#update').html(output);
  });
}

function loadNewsTags(queryString) {
  var output= "";
  console.log(queryString);
  $.getJSON('/alumni/news/tagged/data.json', function(data) {
    if (queryString["tagged"] != null) {
      var myExp  = queryString["tagged"]; 
      $.each(data, function(key, val) {
        if ((val.tags.search(myExp) != -1)) {
          output += '<div class="snippet news-listing columns small-12">';
          output += '<a class="clearfix" href="'+ val.link +'">';
          output += '<div class="date-stamp"><div class="month">'+ val.month +'</div><div class="day">'+ val.day +'</div></div>';
          output += '<div class="snippet-text">';
          output += '<h2 class="h3 title">'+val.title+'</h2>';
          output += '<p>'+val.teaser+'</p>';
          output += '</div>';
          output += '</a>';
          output += '</div>';
        }
      }); //get JSON
    } else {
      output="<p>There are no news matching provided keyword.</p>";
    }    
    $('#update').html(output);
  });
}
    
function resizeSidebar(group) {
  if($('#disqus_thread iframe').length && $('#disqus_thread iframe').css('height') != '0px') {
    equalHeight(group);
    return true;
  }
  else if($('#disqus_thread').length) {
    // not found, call function again
    setTimeout(function(){ resizeSidebar(group); }, 500);
    return false;
  }
}


if(!$('.accordion dd').length) {
  $('.accordion').hide();
  $('.course-home-expand').hide();
}


// Event date fix
if ($('.sdate').length) {
	var fromdate = $('.sdate').html();
	var todate = $('.to-date time').html();
	if(fromdate != todate) {
		$('.to-date').removeClass('sr-only');
	}
}


//Emergency Banner
var isPreview = false;
function checkEmergency() {

	var EmCookieSet = getCookie('emergency').split(',');
    var url = '/notice/';
    if (url.indexOf('/terminalfour/preview/') != -1) {
      console.log("Emergency notice doesn't work in preview");
      isPreview = true;
      return false;
    }
	var checkBanner = $.getJSON( url + "emergency.json", function(data) {
  		// Ignore dummy element
		if (data.notices.length > 1) {
          	// Create an array containing the IDs of all the notices already output on the page
          	var noticesOnPage = $('.notice[data-id]').map(function() {
    			return $.map($(this).data(), function(v) {
        			return v;
    			});
			}).get();
          	
            // Iterate over each notice in the JSON
			for (i = 0; i < data.notices.length - 1; i++) {
              
              	// Checks if the notice is in the cookie
              	var noticeInCookie = ($.inArray(data.notices[i].id, EmCookieSet) < 0)?false:true;
				// Checks if notice is already on the page
              	var noticeOnPage = ($.inArray(data.notices[i].id, noticesOnPage) < 0)?false:true;
              	// Checks if notice is of type 'emergency;
              	var isEmergency = (data.notices[i].noticetype == 'emergency')?true:false;
              
              
              	// Output the notice only if: 
              	// this notice is not in the cookie and is not on the page OR
              	// the notice is in the cookie AND not on the page already but is also an Emergency notice
				if((!noticeInCookie && !noticeOnPage) || (noticeInCookie && !noticeOnPage && isEmergency)) {
					$('.emergencynotice').append('<div class="notice ' + data.notices[i].noticetype + '" data-id="' + data.notices[i].id + '"><div class="row"><a href="' + data.notices[i].url + '">' + data.notices[i].message + '</a><span class="fa fa-times fa-lg" data-id="' + data.notices[i].id + '"></span></div></div>');
                  	
                  	// Remove ability to dismiss "Emergency" notices
                  	if (isEmergency) {
                		$('.fa[data-id="'+data.notices[i].id+'"]').remove();
                    }
                }
            }
          
          	// Hide notices on click
			$('.notice .fa').on('click', function(){
				var thisId = $(this).attr('data-id');
				var parentNotice = $(this).parents('.notice').addClass('closed');
    			
              	// Double checks notice type before addign to cookie
              	if (!parentNotice.hasClass('emergency')) {
                    var currentCookie = getCookie('emergency');
                  
					if (currentCookie == '') {
						setCookie('emergency',thisId,1);
					} 
                  	else {
                    	var cookieArray = currentCookie.split(',');
                    	if ($.inArray(thisId, cookieArray) < 0) {
							setCookie('emergency',currentCookie +',' + thisId,1);
                    	}
                    }
				}
			});
		}
	}).fail(function() {
		console.log( "Failed to get emergency notice JSON File" );
	})
    
	setTimeout(function(){
    	checkEmergency();
  	}, 10000);
}

$(document).ready(function () {
  checkEmergency()
});

$(document).ready(function(){
	if ($('.slick-slider').length) {
    	$('.slick-slider').slick({
       		autoplay: true,
       		autoplaySpeed: 3000,
       		speed: 1500,
          	dots: true,
       		nextArrow: '<span class="fa fa-arrow-circle-o-right next"></span>',
       		prevArrow: '<span class="fa fa-arrow-circle-o-left previous"></span>',
       		fade: true,
    	});
  	}
});



$('table').each(function(){
	$(this).wrap('<div class="table-wrap"></div>');
})



